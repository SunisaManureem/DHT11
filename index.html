<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Temperature and Humidity Monitor</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* ======= Theme (iOS glass) ======= */
    :root{
      --text:#f3f7fd;
      --muted:rgba(255,255,255,.85);
      --panel:rgba(255,255,255,.14);
      --panel-2:rgba(255,255,255,.18);
      --border:rgba(255,255,255,.28);
      --shadow:0 20px 46px rgba(10,25,60,.30);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      color:var(--text);
      font-family:'Poppins',system-ui,Segoe UI,Arial,sans-serif;
      background:
        radial-gradient(1100px 800px at 90% -10%, rgba(255,255,255,.16) 0%, rgba(255,255,255,0) 60%),
        linear-gradient(180deg, #1d3f8f 0%, #3f66bf 55%, #6aa6da 100%);
      display:flex;align-items:center;justify-content:center;
      padding:20px;
    }

    /* ======= Card container ======= */
    .board{
      width:min(980px,95vw);
      border-radius:28px;
      background:var(--panel);
      backdrop-filter: blur(16px) saturate(120%);
      -webkit-backdrop-filter: blur(16px) saturate(120%);
      border:1px solid var(--border);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .bar{
      display:flex;align-items:center;justify-content:space-between;
      padding:18px 22px;
      border-bottom:1px solid rgba(255,255,255,.12);
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,0));
    }
    .bar .place{font-weight:700;font-size:22px;letter-spacing:.2px}
    .bar .chip{
      font-size:14px;font-weight:600;color:#19325e;
      background:rgba(255,255,255,.92); border:1px solid rgba(255,255,255,.95);
      padding:6px 12px; border-radius:999px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.3fr .7fr;
      gap:18px;
      padding:18px;
    }
    @media (max-width:860px){ .grid{grid-template-columns:1fr} }

    /* ======= Left: main temp with icon ======= */
    .main{
      background:var(--panel-2);
      border:1px solid var(--border);
      border-radius:22px;
      padding:20px;
      box-shadow:var(--shadow);
      display:grid; grid-template-columns: 96px 1fr; gap:16px;
      align-items:center;
    }
    .icon{
      width:78px;height:78px;border-radius:18px;
      background:linear-gradient(180deg, rgba(255,255,255,.24), rgba(255,255,255,.08));
      border:1px solid var(--border);
      display:flex;align-items:center;justify-content:center;
      font-size:40px; box-shadow: inset 0 12px 24px rgba(255,255,255,.15), inset 0 -10px 20px rgba(0,0,0,.15);
    }
    .tempBlock{display:flex;flex-direction:column}
    .tempRow{display:flex;align-items:baseline;gap:10px}
    #temperature-value{
      font-size: clamp(44px, 9vw, 76px);
      font-weight:800; line-height:1; text-shadow:0 2px 0 rgba(0,0,0,.25);
    }
    .unit{font-weight:700;color:var(--muted)}

    .subtext{margin-top:4px;color:var(--muted);font-weight:600}

    /* ======= Right: humidity donut + status ======= */
    .side{display:flex;flex-direction:column;gap:18px}

    .panel{
      background:var(--panel-2);
      border:1px solid var(--border);
      border-radius:20px;
      padding:18px; box-shadow:var(--shadow);
    }

    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}

    .label{font-weight:700;color:var(--muted);display:flex;align-items:center;gap:8px}
    /* donut */
    .donut{
      --p:0; /* filled percent (0-100) */
      width:128px;height:128px;border-radius:50%;
      background:
        conic-gradient(#a7d0ff calc(var(--p)*1%), rgba(255,255,255,.12) 0),
        radial-gradient(closest-side, rgba(0,0,0,0) 70%, rgba(255,255,255,.25) 0);
      display:flex;align-items:center;justify-content:center;
      border:1px solid var(--border);
      box-shadow: inset 0 10px 24px rgba(255,255,255,.12), inset 0 -12px 22px rgba(0,0,0,.15);
    }
    .donut .num{font-size:34px;font-weight:800;text-shadow:0 2px 0 rgba(0,0,0,.25)}
    .donut small{color:var(--muted);font-weight:700;margin-left:4px}

    /* status chip (‡πÉ‡∏ä‡πâ id ‡πÄ‡∏î‡∏¥‡∏°) */
    #status-message{
      text-align:center;color:#0b1633;
      background:rgba(255,255,255,.92);border:1px solid rgba(255,255,255,.95);
      border-radius:12px;padding:10px 12px;font-weight:600;
      box-shadow:0 10px 22px rgba(0,0,0,.18);
    }
  </style>
</head>
<body>
  <div class="board">
    <div class="bar">
      <div class="place">Bangkok</div>
      <div class="chip">24 ‡∏ä‡∏°.</div>
    </div>

    <div class="grid">
      <!-- Left: Temperature block -->
      <section class="main">
        <div class="icon">‚òÄÔ∏è</div>
        <div class="tempBlock">
          <div class="tempRow">
            <div id="temperature-value">--</div>
            <div class="unit">¬∞C</div>
          </div>
          <div class="subtext">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</div>
        </div>
      </section>

      <!-- Right: Humidity + status -->
      <section class="side">
        <div class="panel">
          <div class="row" style="gap:18px;">
            <div class="label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ó‡∏ò‡πå üíß</div>
            <div class="donut" id="humidity-donut" style="--p:0">
              <span class="num" id="humidity-value">--</span><small>%</small>
            </div>
          </div>
        </div>

        <div class="panel" style="display:flex;justify-content:center;align-items:center;">
          <div id="status-message">Connecting...</div>
        </div>
      </section>
    </div>
  </div>

  <script>
    /* ===== ‡πÑ‡∏°‡πà‡πÅ‡∏ï‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤ ===== */
    const BACKEND_BASE = "https://dht11-2gtd.onrender.com";

    function setText(id, value){
      const el = document.getElementById(id);
      if (el) el.textContent = value;
    }

    async function fetchData() {
      try {
        const res = await fetch(`${BACKEND_BASE}/data`, { cache: "no-store" });
        const data = await res.json();

        if (data.temperature !== null) {
          setText("temperature-value", Number(data.temperature).toFixed(1));
        }
        if (data.humidity !== null) {
          const h = Number(data.humidity);
          setText("humidity-value", h.toFixed(0));
          /* ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï donut ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡πâ‡∏ß‡∏ô ‡πÜ */
          const donut = document.getElementById('humidity-donut');
          if (donut) donut.style.setProperty('--p', Math.max(0, Math.min(100, h)));
        }
        setText("status-message", "Data updated ‚úÖ");
      } catch (err) {
        console.error("Fetch error:", err);
        setText("status-message", "Error fetching data ‚ö†Ô∏è");
      }
    }

    fetchData();
    setInterval(fetchData, 5000);
  </script>
</body>
</html>
